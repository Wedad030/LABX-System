<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© - LABX</title>
  <link rel="stylesheet" href="style.css">

  <style>
    .details-box {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
      margin-top: 20px;
      line-height: 1.9;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #0f766e;
      margin-top: 18px;
      margin-bottom: 5px;
    }
    .qr-img {
      display: block;
      margin: 15px auto;
      width: 180px;
      height: 180px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
    }
    .status-pill {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      margin-top: 6px;
      color: white;
    }
  </style>
</head>

<body class="bg">

<div class="layout">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="top-header">
    <div class="top-header-right">
      <img src="labx.jpeg" class="logo-img" alt="LABX Dental">
      <div class="brand-text">
        <div class="brand-title">LABX DENTAL</div>
        <div class="brand-sub">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</div>
      </div>
    </div>

    <div class="top-header-left">
      <button onclick="window.history.back()" class="btn-logout" style="background:#0f766e;">
        Ø±Ø¬ÙˆØ¹
      </button>
    </div>
  </header>


  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <main class="main-card fade-in">
    <h2 style="text-align:center;margin-bottom:10px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h2>

    <div id="details" class="details-box">
      ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
    </div>

    <button onclick="window.print()"
            class="btn-logout"
            style="background:#0f766e;margin-top:20px;width:100%;">
      Ø·Ø¨Ø§Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© ğŸ–¨
    </button>
  </main>
</div>


<script>
// Ø¬Ù„Ø¨ Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ± Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ?file=...
function getParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

let fileParam = getParam("file");
let cases = JSON.parse(localStorage.getItem("labxNewCases") || "[]");
let techList = JSON.parse(localStorage.getItem("techList") || "[]");

// Ø®Ø±ÙŠØ·Ø© Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙÙ†ÙŠÙŠÙ†
let techColors = {};
techList.forEach(t => techColors[t.name] = t.color);

const box = document.getElementById("details");

let caseData = null;

// Ù†Ø­Ø§ÙˆÙ„ Ù†Ù„Ø§Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„Ø©
if (fileParam) {
  caseData = cases.find(c => c.fileNumber === fileParam);
} else {
  // Ø§Ø­ØªÙŠØ§Ø·: Ø¥Ø°Ø§ ÙÙŠ selectedCaseId Ù…Ø­ÙÙˆØ¸ Ø³Ø§Ø¨Ù‚Ø§Ù‹
  const selectedId = localStorage.getItem("selectedCaseId");
  if (selectedId) {
    caseData = cases.find(c => c.id == selectedId);
  }
}

if (!caseData) {
  box.innerHTML = "<p style='color:#b91c1c;font-weight:bold;'>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©</p>";
} else {

  // Ù„ÙˆÙ† Ø§Ù„ÙÙ†ÙŠ
  let techColor = techColors[caseData.technicianName] || "#0f766e";

  // Ø³ØªØ§ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
  let statusColor = "#0f766e";
  if (caseData.status === "ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡") statusColor = "#f59e0b";
  if (caseData.status === "Ø¬Ø§Ù‡Ø²Ø©") statusColor = "#22c55e";
  if (caseData.status === "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©") statusColor = "#2563eb";

  box.innerHTML = `
    <h3 style="font-size:22px;margin-bottom:5px;">${caseData.patientName}</h3>
    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${caseData.fileNumber}</p>

    <span class="status-pill" style="background:${statusColor};">
      Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨: ${caseData.status || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
    </span>

    <div class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</div>
    <p><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨:</strong> ${caseData.doctorName || "-"}</p>
    <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:</strong> ${caseData.assistantName || "-"}</p>
    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${caseData.clinicNumber || "-"}</p>

    <div class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„</div>
    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø© / Ø§Ù„Ù‚Ø³Ù…:</strong> ${caseData.caseType || "-"}</p>
    <p><strong>Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong>
      <span style="padding:3px 10px;border-radius:999px;background:${techColor};color:white;">
        ${caseData.technicianName || "-"}
      </span>
    </p>
    <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${caseData.notes || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}</p>

    <div class="section-title">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„Ø­Ø§Ù„Ø©</div>
    <p><strong>ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨:</strong> ${caseData.createdAt || "-"}</p>
    ${caseData.readyTime ? `<p><strong>ØªØ§Ø±ÙŠØ® Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${caseData.readyTime}</p>` : ""}
    ${caseData.distributedTime ? `<p><strong>ØªØ§Ø±ÙŠØ® ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${caseData.distributedTime}</p>` : ""}
    ${caseData.receivedAt ? `<p><strong>ØªØ§Ø±ÙŠØ® Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${caseData.receivedAt}</p>` : ""}

    <div class="section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</div>
    <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:</strong> ${caseData.receivedBy || "-"}</p>
    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ø§Ø³ØªÙ„Ø§Ù…):</strong> ${caseData.clinicNo || "-"}</p>

    <div class="section-title">Ø±Ù…Ø² Ø§Ù„Ù€ QR</div>
    <img class="qr-img"
         src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${caseData.qrValue}"
         alt="QR Code">

    <p><strong>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù€ QR:</strong> ${caseData.qrValue}</p>
  `;
}
</script>

</body>
</html>
