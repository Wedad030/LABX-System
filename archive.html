<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>أرشيف الحالات - LABX</title>
    <link rel="stylesheet" href="style.css">

    <style>
        .search-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 10px #00000015;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #94a3b8;
            margin-bottom: 12px;
        }

        .archive-tile {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 4px 10px #00000015;
        }
    </style>
</head>


<body class="bg">
<div class="layout">

    <!-- الهيدر -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img">
            <div class="brand-text">
                <div class="brand-title">LABX DENTAL</div>
                <div class="brand-sub">أرشيف الحالات</div>
            </div>
        </div>

        <div class="top-header-left">
            <button onclick="window.location.href='index.html'"
                    class="btn-logout" style="background:#0f766e;">
                رجوع
            </button>
        </div>
    </header>


    <!-- المحتوى -->
    <main class="main-card fade-in">

        <h2 style="margin-bottom:20px;text-align:center;">أرشيف جميع الحالات</h2>

        <!-- صندوق البحث -->
        <div class="search-box">
            <input id="searchInput" class="search-input"
                   oninput="filterCases()" placeholder="ابحث باسم المريض أو رقم الملف أو القسم أو الفني...">
        </div>

        <!-- عدد الحالات -->
        <p id="countLabel" class="role-badge"></p>

        <!-- عرض الحالات -->
        <div id="archiveContainer"></div>

    </main>
</div>


<script>
// ---------------------------------------------------------
// جلب البيانات من الإعدادات
// ---------------------------------------------------------
let techList = JSON.parse(localStorage.getItem("techList") || "[]");
let deptList = JSON.parse(localStorage.getItem("deptList") || "[]");
let cases = JSON.parse(localStorage.getItem("labxNewCases") || "[]");


// خريطة ألوان الفنيين
let techColors = {};
techList.forEach(t => techColors[t.name] = t.color);


// ---------------------------------------------------------
// عرض الحالات في الأرشيف
// ---------------------------------------------------------
function showArchive(list = cases) {
    const container = document.getElementById("archiveContainer");
    const countLabel = document.getElementById("countLabel");

    container.innerHTML = "";
    countLabel.innerText = `عدد الحالات في الأرشيف: ${list.length}`;

    list.forEach(c => {
        let color = techColors[c.technicianName] || "#0f766e";

        let box = document.createElement("div");
        box.className = "archive-tile";
        box.style.borderRight = `10px solid ${color}`;

        box.innerHTML = `
            <h3>${c.patientName}</h3>
            <p>رقم الملف: ${c.fileNumber}</p>
            <p>القسم: ${c.caseType}</p>
            <p>الفني: ${c.technicianName}</p>
            <p>الحالة: ${c.status}</p>
            <p style="font-size:12px;color:#64748b;">تاريخ الإنشاء: ${c.createdAt}</p>

            ${c.readyTime ? `<p style="font-size:12px;color:#16a34a;">جاهزة منذ: ${c.readyTime}</p>` : ""}

            ${c.distributedTime ? `<p style="font-size:12px;color:#2563eb;">تم توزيعها: ${c.distributedTime}</p>` : ""}
        `;

        container.appendChild(box);
    });
}


// ---------------------------------------------------------
// البحث في الأرشيف
// ---------------------------------------------------------
function filterCases() {
    let q = document.getElementById("searchInput").value.trim().toLowerCase();

    let filtered = cases.filter(c =>
        c.patientName.toLowerCase().includes(q) ||
        c.fileNumber.toLowerCase().includes(q) ||
        c.caseType.toLowerCase().includes(q) ||
        c.technicianName.toLowerCase().includes(q)
    );

    showArchive(filtered);
}


// تشغيل الصفحة
showArchive();

</script>


</body>
</html>
