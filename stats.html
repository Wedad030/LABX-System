<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>الإحصائيات - LABX</title>
    <link rel="stylesheet" href="style.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .stats-box {
            background: white;
            padding: 18px;
            border-radius: 14px;
            box-shadow: 0 4px 10px #00000010;
            margin-bottom: 18px;
            text-align: center;
        }

        .stats-number {
            font-size: 32px;
            font-weight: bold;
            color: #0f766e;
            margin-top: 8px;
        }
    </style>

</head>

<body class="bg">

<div class="layout">

    <!-- الهيدر -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img" alt="LABX">
            <div class="brand-text">
                <div class="brand-title">LABX DENTAL</div>
                <div class="brand-sub">الإحصائيات</div>
            </div>
        </div>

        <div class="top-header-left">
            <button onclick="window.location.href='index.html'" 
                    class="btn-logout" 
                    style="background:#0f766e;">
                رجوع
            </button>
        </div>
    </header>


    <!-- المحتوى -->
    <main class="main-card fade-in">

        <h2 style="text-align:center;margin-bottom:25px;">لوحة الإحصائيات العامة</h2>

        <!-- عدادات رئيسية -->
        <div class="tiles-grid">

            <div class="stats-box">
                <h3>الحالات الكلية</h3>
                <div id="totalCases" class="stats-number">0</div>
            </div>

            <div class="stats-box">
                <h3>الحالات تحت الإجراء</h3>
                <div id="underProcess" class="stats-number">0</div>
            </div>

            <div class="stats-box">
                <h3>الحالات الجاهزة</h3>
                <div id="readyCount" class="stats-number">0</div>
            </div>

            <div class="stats-box">
                <h3>الحالات المسلّمة للعيادة</h3>
                <div id="clinicReceived" class="stats-number">0</div>
            </div>

        </div>


        <!-- مخططات -->
        <h3 style="margin-top:35px;">إحصائيات الأقسام</h3>
        <canvas id="departmentChart" style="margin-top:15px;"></canvas>

        <h3 style="margin-top:45px;">إحصائيات الفنيين</h3>
        <canvas id="techChart" style="margin-top:15px;"></canvas>

    </main>
</div>



<script>
/* -------------------------------------------------------------
   جلب الحالات من LocalStorage
--------------------------------------------------------------*/
let cases = JSON.parse(localStorage.getItem("labxNewCases") || "[]");

/* -------------------------------------------------------------
   1) حساب العدادات الرئيسية
--------------------------------------------------------------*/
document.getElementById("totalCases").innerText = cases.length;

document.getElementById("underProcess").innerText =
    cases.filter(c => c.status === "تحت الإجراء").length;

document.getElementById("readyCount").innerText =
    cases.filter(c => c.status === "جاهزة").length;

document.getElementById("clinicReceived").innerText =
    cases.filter(c => c.status === "تم التسليم للعيادة").length;


/* -------------------------------------------------------------
   2) إحصائيات الأقسام
--------------------------------------------------------------*/
const departments = {
    "CAD/CAM": 0,
    "PFM": 0,
    "المتحرك": 0,
    "المؤقت": 0,
    "الصب": 0
};

// عد الحالات لكل قسم
cases.forEach(c => {
    if (departments[c.caseType] !== undefined) {
        departments[c.caseType]++;
    }
});

const depLabels = Object.keys(departments);
const depValues = Object.values(departments);


/* الرسم البياني للأقسام */
new Chart(document.getElementById("departmentChart"), {
    type: 'bar',
    data: {
        labels: depLabels,
        datasets: [{
            label: 'عدد الحالات',
            data: depValues,
            backgroundColor: ['#0f766e', '#8b5cf6', '#22c55e', '#f59e0b', '#6b7280']
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true }
        }
    }
});


/* -------------------------------------------------------------
   3) إحصائيات الفنيين
--------------------------------------------------------------*/
let techCount = {};

cases.forEach(c => {
    if (!techCount[c.technicianName]) techCount[c.technicianName] = 0;
    techCount[c.technicianName]++;
});

const techLabels = Object.keys(techCount);
const techValues = Object.values(techCount);


/* رسم الفنيين Pie chart */
new Chart(document.getElementById("techChart"), {
    type: 'pie',
    data: {
        labels: techLabels,
        datasets: [{
            data: techValues,
            backgroundColor: [
                '#3b82f6','#10b981','#f43f5e','#8b5cf6','#f59e0b',
                '#6b7280','#0f766e','#14b8a6','#f97316','#22c55e'
            ]
        }]
    },
});
</script>

</body>
</html>
