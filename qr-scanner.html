<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>QR Scanner - LABX</title>

    <!-- ØªØµÙ…ÙŠÙ… Ø³Ø±ÙŠØ¹ Ù„Ù„ØµÙØ­Ø© -->
    <link rel="stylesheet" href="style.css">

    <style>
        body {
            text-align: center;
            padding: 30px;
        }

        h2 {
            margin-bottom: 15px;
        }

        #preview {
            width: 90%;
            max-width: 420px;
            margin: 20px auto;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 4px 18px rgba(0,0,0,0.15);
            animation: fadeIn 0.5s ease-out;
        }

        #resultBox {
            margin-top: 18px;
            padding: 18px;
            background: #e7ffe7;
            border-radius: 12px;
            display: none;
            animation: slideUp 0.6s ease-out;
        }

        #switchBtn {
            margin-top: 15px;
            background: var(--green-main);
            color: white;
            padding: 12px 22px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: .25s;
        }

        #switchBtn:hover {
            transform: scale(1.05);
            opacity: .9;
        }
    </style>

    <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‡Ø§Ù†Ø¯Ø³ÙˆÙ† QR -->
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body class="bg fade-in">

    <h2>ğŸ“· Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø­Ø§Ù„Ø©</h2>

    <!-- Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <div id="preview"></div>

    <!-- Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø³Ø­ -->
    <div id="resultBox">
        <h3>âœ” ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­</h3>
        <p id="qrResult"></p>

        <button onclick="goToCase()" 
                style="margin-top:15px;background:#0f766e;color:#fff;padding:12px 25px;border-radius:10px;border:none;cursor:pointer;">
            Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©
        </button>
    </div>

    <!-- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <button id="switchBtn">ğŸ”„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>

    <script>
        let lastQR = "";
        let currentCamera = "environment"; // ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©

        function startScanner() {
            const html5QrCode = new Html5Qrcode("preview");

            Html5Qrcode.getCameras().then((devices) => {
                const cameraId = devices.find(d => d.label.includes("back"))?.id || devices[0].id;

                html5QrCode.start(
                    cameraId,
                    { fps: 10, qrbox: 250 },
                    qrCodeMessage => {
                        lastQR = qrCodeMessage;
                        document.getElementById("qrResult").innerText = lastQR;
                        document.getElementById("resultBox").style.display = "block";
                    },
                    errorMessage => {}
                );

                // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
                document.getElementById("switchBtn").onclick = async () => {
                    html5QrCode.stop();
                    currentCamera = currentCamera === "environment" ? "user" : "environment";
                    document.getElementById("resultBox").style.display = "none";

                    const camId = devices.find(d =>
                        currentCamera === "environment"
                            ? d.label.toLowerCase().includes("back")
                            : d.label.toLowerCase().includes("front")
                    )?.id || devices[0].id;

                    html5QrCode.start(
                        camId,
                        { fps: 10, qrbox: 250 },
                        qrCodeMessage => {
                            lastQR = qrCodeMessage;
                            document.getElementById("qrResult").innerText = lastQR;
                            document.getElementById("resultBox").style.display = "block";
                        }
                    );
                };
            });
        }

        startScanner();

        function goToCase() {
            if (!lastQR) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯!");
            window.location.href = `case-details.html?id=${lastQR}`;
        }
    </script>

</body>
</html>
