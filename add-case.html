// --------------------
// Firebase config
// --------------------
var firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    databaseURL: "YOUR_DB_URL",
    projectId: "labx-system",
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

// ---------------------------
// فنيين حسب كل قسم
// ---------------------------
const technicians = {
    cad: [
        {name:"قاسم عسيري", off:false},
        {name:"أحمد كوشان", off:false},
        {name:"عبدالله الرشيد", off:false},
        {name:"عبدالله الشهراني", off:false},
        {name:"أحمد القحطاني", off:false},
        {name:"يحيى عسيري", off:true}, // إجازة
    ],

    pfm: [
        {name:"سلطان الأحمدي", off:true},
        {name:"أيمن الشهري", off:false},
        {name:"فيصل الوادعي", off:false}
    ],

    ortho: [
        {name:"تركي الشهري", off:true},
        {name:"وليد الشهري", off:false},
        {name:"أسامة عسيري", off:false}
    ],

    removable: [
        {name:"رشيد الكثيري", off:false},
        {name:"أحمد الصخري", off:false},
        {name:"عبداللطيف عسيري", off:false},
        {name:"محمد الشرفان", off:false},
        {name:"الاء", off:false},
        {name:"هيام", off:false},
        {name:"محمد الغامدي", off:false},
        {name:"منصور العويرضي", off:false}
    ],

    temp: [
        {name:"أحمد الشبل", off:false},
        {name:"وليد السويري", off:false},
        {name:"فهد العتيبي", off:false},
        {name:"عبدالله العود", off:false}
    ],

    casting: [
        {name:"فهد الخميس", off:false}
    ]
};

// ---------------------------
// عند اختيار القسم
// ---------------------------
document.getElementById("department").addEventListener("change", function () {
    let dep = this.value;
    let techList = technicians[dep];
    let techSelect = document.getElementById("technician");

    techSelect.innerHTML = "";

    techList.forEach(t => {
        let opt = document.createElement("option");
        opt.textContent = t.name;
        opt.value = t.name;

        if (t.off) {
            opt.disabled = true;
            opt.classList.add("orange");
            opt.textContent = t.name + " (إجازة)";
        }

        techSelect.appendChild(opt);
    });
});

// ---------------------------
// كشف الحاله المرفوضة
// ---------------------------
document.getElementById("caseType").addEventListener("change", function () {
    let type = this.value;
    let alertBox = document.getElementById("rejectAlert");

    if (type === "edit") {
        alertBox.style.display = "block";
    } else {
        alertBox.style.display = "none";
    }
});

// ---------------------------
// حفظ الحالة
// ---------------------------
function saveCase() {
    let id = Date.now();
    let patient = document.getElementById("patientName").value;
    let file = document.getElementById("fileNumber").value;
    let doctor = document.getElementById("doctorName").value;
    let assistant = document.getElementById("assistantName").value;
    let clinic = document.getElementById("clinicNumber").value;
    let ctype = document.getElementById("caseType").value;
    let dep = document.getElementById("department").value;
    let tech = document.getElementById("technician").value;
    let notes = document.getElementById("notes").value;

    let caseNumber = "LABX-" + id;

    let caseData = {
        patient, file, doctor, assistant,
        clinic, ctype, dep, tech, notes,
        caseNumber,
        date: new Date().toLocaleString("en-GB")
    };

    db.ref("cases/" + id).set(caseData);

    // عرض النتيجة
    document.getElementById("resultText").innerHTML =
        "رقم التوزيع: " + caseNumber + "<br>" +
        "الفني: " + tech + "<br>" +
        "القسم: " + dep;

    document.getElementById("resultCard").style.display = "block";
}
