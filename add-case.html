<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إضافة حالة جديدة</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: 'Tajawal', sans-serif; background:#f5f5f5; padding:20px; }
.container { background:#fff; padding:25px; max-width:600px; margin:auto; border-radius:12px;
box-shadow:0 4px 15px rgba(0,0,0,0.1); }
input, select, textarea {
width:100%; padding:12px; margin:8px 0; border-radius:8px;
border:1px solid #ccc; font-size:16px;
}
button {
width:100%; padding:12px; background:#0a6847; border:none; color:#fff;
font-size:18px; border-radius:8px; cursor:pointer; margin-top:15px;
}
button:hover { background:#09543a; }

.badge { padding:6px 12px; border-radius:6px; color:#fff; font-size:14px; }
.red { background:#d72638; }
.orange { background:#ff9f1c; }
.green { background:#2ec4b6; }

#resultCard {
display:none; margin-top:25px; background:#fff; padding:18px; border-radius:10px;
box-shadow:0 3px 12px rgba(0,0,0,0.15);
}
</style>
</head>

<body>
<div class="container">
<h2>إضافة حالة جديدة</h2>

<label>اسم المريض:</label>
<input type="text" id="patientName">

<label>رقم الملف:</label>
<input type="number" id="fileNumber">

<label>اسم الطبيب:</label>
<input type="text" id="doctor">

<label>اسم المساعد:</label>
<input type="text" id="assistant">

<label>رقم العيادة:</label>
<input type="number" id="clinic">

<label>نوع الحالة:</label>
<select id="caseType">
<option value="">اختر نوع الحالة</option>
<option value="جديدة">جديدة</option>
<option value="تعديل">تعديل</option>
<option value="مرفوضة">مرفوضة</option>
</select>

<div id="rejectAlert" class="badge red" style="display:none">⚠ هذه الحالة مرفوضة من المعمل</div>

<label>القسم:</label>
<select id="department">
<option value="">اختر القسم</option>
<option value="cad">CAD CAM</option>
<option value="pfm">PFM</option>
<option value="ortho">Ortho</option>
<option value="removable">Removable</option>
<option value="temporary">Temporary</option>
<option value="casting">Casting</option>
</select>

<label>الفني المسؤول:</label>
<select id="technician">
<option value="">اختر القسم أولاً</option>
</select>

<label>ملاحظات:</label>
<textarea id="notes"></textarea>

<button onclick="saveCase()">حفظ الحالة</button>

<div id="resultCard">
<h3>تم حفظ الحالة بنجاح</h3>
<p><b>اسم المريض:</b> <span id="rName"></span></p>
<p><b>رقم الملف:</b> <span id="rFile"></span></p>
<p><b>رقم التوزيع:</b> <span id="rCode"></span></p>
<img id="qrImage" style="width:150px; margin-top:10px;">
</div>

</div>

<script>
// ============================
// 1️⃣ الفنيين حسب الأقسام
// ============================
const technicians = {
cad: [
{ name:"قاسم عسيري", off:false }, { name:"أحمد كوشان", off:true },
{ name:"عبدالله الرشيد", off:false }, { name:"عبدالله الشهراني", off:false },
{ name:"أحمد القحطاني", off:false }, { name:"يحيى عسيري", off:true }
],
pfm: [
{ name:"سلطان الأحمري", off:true }, { name:"أيمن الشهري", off:false },
{ name:"فيصل الوادعي", off:false }
],
ortho: [
{ name:"تركي الشهري", off:true }, { name:"وليد الشهري", off:false },
{ name:"أسامة عسيري", off:false }
],
removable: [
{ name:"رشيد الكثيري", off:false }, { name:"أحمد الصخري", off:false },
{ name:"عبداللطيف عسيري", off:false }, { name:"محمد الشرفان", off:false },
{ name:"الاء", off:false }, { name:"هيام", off:false },
{ name:"محمد الغامدي", off:false }, { name:"منصور العويرضي", off:false }
],
temporary: [
{ name:"أحمد الشبل", off:false }, { name:"وليد السويري", off:false },
{ name:"فهد العتيبي", off:false }, { name:"عبدالله العود", off:false }
],
casting: [
{ name:"فهد الخميس", off:false }
]
};

// ============================
// 2️⃣ إظهار التنبيه إذا الحالة مرفوضة
// ============================
document.getElementById("caseType").addEventListener("change", function(){
document.getElementById("rejectAlert").style.display =
(this.value === "مرفوضة") ? "block" : "none";
});

// ============================
// 3️⃣ تعبئة الفنيين حسب القسم
// ============================
document.getElementById("department").addEventListener("change", function(){
let dep = this.value;
let techList = technicians[dep] || [];
let select = document.getElementById("technician");

select.innerHTML = "";
techList.forEach(t => {
let opt = document.createElement("option");
opt.value = t.name;
opt.textContent = t.off ? `${t.name} (إجازة)` : t.name;

if(t.off) opt.style.color = "orange";
else opt.style.color = "black";

opt.disabled = t.off;

select.appendChild(opt);
});
});

// ============================
// 4️⃣ حفظ الحالة
// ============================
function saveCase() {

let name = document.getElementById("patientName").value;
let file = document.getElementById("fileNumber").value;
let dep = document.getElementById("department").value;
let tech = document.getElementById("technician").value;

if(!name || !file || !dep || !tech){
alert("⚠ يرجى تعبئة جميع البيانات المطلوبة");
return;
}

let caseNumber = Math.floor(100000 + Math.random() * 900000);
let qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${caseNumber}`;

document.getElementById("rName").innerHTML = name;
document.getElementById("rFile").innerHTML = file;
document.getElementById("rCode").innerHTML = caseNumber;
document.getElementById("qrImage").src = qrURL;

document.getElementById("resultCard").style.display = "block";
}
</script>

</body>
</html>
