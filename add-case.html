<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إضافة حالة جديدة</title>
<link rel="stylesheet" href="style.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body { background:#f5f5f5; font-family:'Tajawal', sans-serif; }
.container {
    max-width:900px;
    margin:25px auto;
    background:#fff;
    padding:25px;
    border-radius:15px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
label { font-weight:bold; margin-top:15px; display:block; }
input, select, textarea {
    width:100%;
    padding:10px;
    margin-top:5px;
    border:1px solid #ccc;
    border-radius:8px;
}
textarea { min-height:60px; }
.btn {
    margin-top:20px;
    width:100%;
    background:#0f766e;
    padding:12px;
    border:none;
    border-radius:10px;
    color:white;
    font-size:16px;
}
.alert-red {
    display:none;
    background:#fee2e2;
    padding:10px;
    border-radius:10px;
    color:#b91c1c;
    border-right:4px solid #dc2626;
}
</style>
</head>

<body>

<div class="container">

<h2 style="text-align:center; color:#0f766e;">إضافة حالة جديدة</h2>

<div id="rejectAlert" class="alert-red">⚠ هذه الحالة تعتبر مرفوضة</div>

<label>اسم المريض:</label>
<input id="patientName">

<label>رقم الملف:</label>
<input id="fileNumber">

<label>اسم الطبيب:</label>
<input id="doctorName">

<label>اسم المساعدة:</label>
<input id="assistantName">

<label>رقم العيادة:</label>
<input id="clinicNumber">

<label>نوع الحالة:</label>
<select id="caseType">
    <option value="">— اختر —</option>
    <option value="new">جديدة</option>
    <option value="adjust">تعديل</option>
</select>

<label>القسم:</label>
<select id="department">
    <option value="">— اختر القسم —</option>
    <option value="cadcam">CAD CAM</option>
    <option value="pfm">PFM</option>
    <option value="ortho">ORTHO</option>
    <option value="removable">Removable</option>
    <option value="temp">Temporary</option>
</select>

<label>الفني:</label>
<select id="technician"></select>

<label>ملاحظات:</label>
<textarea id="notes"></textarea>

<div id="qrArea" style="text-align:center; margin-top:20px;"></div>

<button class="btn" onclick="saveCase()">حفظ الحالة</button>

</div>

<script>
// ------------ قائمة الفنين --------------
const technicians = {
    cadcam: ["قاسم عسيري","أحمد كوشان","عبدالله الرشيد","أحمد القحطاني"],
    pfm: ["سلطان الاحمري","أيمن الشهري","فيصل الوادعي"],
    ortho: ["تركي الشهري","وليد الشهري","أسامة عسيري"],
    removable: ["رشيد الكثيري","أحمد الصخري","عبداللطيف عسيري","الاء","هيام"],
    temp: ["أحمد الشبل","وليد السويري","فهد العتيبي"]
};

const vacations = ["تركي الشهري","سلطان الاحمري","يحيى عسيري"];

// ------------ تغيير الفني حسب القسم ----------
document.getElementById("department").addEventListener("change", function() {
    let dept = this.value;
    let techSelect = document.getElementById("technician");
    techSelect.innerHTML = "";

    if (!dept) return;

    technicians[dept].forEach(t => {
        let opt = document.createElement("option");
        opt.value = t;

        if (vacations.includes(t)) {
            opt.textContent = t + " (إجازة)";
            opt.disabled = true;
            opt.style.color = "orange";
        } else {
            opt.textContent = t;
        }

        techSelect.appendChild(opt);
    });
});

// ----------- اظهار تنبيه حالة مرفوضة ----------
document.getElementById("caseType").addEventListener("change", function() {
    document.getElementById("rejectAlert").style.display =
        (this.value === "adjust") ? "block" : "none";
});

// ----------- حفظ الحالة (LocalStorage فقط للعرض) ----------
function saveCase() {

    const caseData = {
        patient: patientName.value,
        file: fileNumber.value,
        doctor: doctorName.value,
        assistant: assistantName.value,
        clinic: clinicNumber.value,
        type: caseType.value,
        dept: department.value,
        tech: technician.value,
        notes: notes.value,
        created: new Date().toLocaleString("en-GB")
    };

    // حفظ محلي للعرض فقط
    localStorage.setItem("lastCase", JSON.stringify(caseData));

    alert("✓ تم حفظ الحالة (نسخة GitHub فقط — بدون Firebase)");

    // QR
    document.getElementById("qrArea").innerHTML = "";
    new QRCode(document.getElementById("qrArea"), {
        text: JSON.stringify(caseData),
        width: 150,
        height: 150
    });
}

</script>

</body>
</html>
