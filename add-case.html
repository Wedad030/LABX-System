<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>إضافة حالة - LABX Dental</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
.container { background:white; padding:20px; border-radius:10px; max-width:600px; margin:auto; }
label { font-weight:bold; margin-top:10px; display:block; }
input, select, textarea {
    width:100%; padding:10px; border-radius:6px; border:1px solid #ccc;
    margin-top:5px; font-size:16px;
}
button {
    width:100%; padding:14px; background:#0b6623;
    color:white; border:none; border-radius:6px;
    margin-top:20px; cursor:pointer; font-size:18px;
}
#rejectAlert {
    display:none; background:#ffdddd; color:#b30000;
    padding:12px; border-left:6px solid #b30000;
    border-radius:6px; margin-top:15px; font-weight:bold;
}
#resultCard {
    display:none; background:white; padding:20px; margin-top:20px; border-radius:10px;
}
.qr-box { text-align:center; margin-top:15px; }
</style>
</head>
<body>

<div class="container">
<h2>إضافة حالة جديدة</h2>

<label>اسم المريض:</label>
<input id="patientName" type="text">

<label>رقم الملف:</label>
<input id="fileNumber" type="number">

<label>اسم الطبيب:</label>
<input id="doctor" type="text">

<label>اسم المساعد:</label>
<input id="assistant" type="text">

<label>رقم العيادة:</label>
<input id="clinic" type="number">

<label>نوع الحالة:</label>
<select id="caseType">
    <option value="">اختر الحالة</option>
    <option>جديدة</option>
    <option>تعديل</option>
    <option>RPD 3 teeth or less</option>
    <option>TM 3 teeth or less</option>
    <option>RPD ثلاث اسنان او اقل</option>
    <option>TM ثلاث اسنان او اقل</option>
</select>

<label>القسم:</label>
<select id="department">
    <option value="">اختر القسم</option>
    <option value="cad">قسم الكاد كام</option>
    <option value="pfm">قسم الـ PFM</option>
    <option value="ortho">قسم الأوثور</option>
    <option value="removable">قسم المتحرك</option>
    <option value="temp">قسم المؤقت</option>
    <option value="casting">قسم الصب</option>
</select>

<label>الفني المسؤول:</label>
<select id="technician"></select>

<div id="rejectAlert">⚠️ هذه الحالة مرفوضة من قبل المعمل ولا يمكن قبولها</div>

<label>ملاحظات:</label>
<textarea id="notes" rows="3"></textarea>

<button onclick="saveCase()">حفظ الحالة</button>
</div>

<div id="resultCard">
<h3>تم حفظ الحالة بنجاح</h3>
<p id="resultText"></p>
<div class="qr-box"><canvas id="qrCode"></canvas></div>
</div>

    // الفنيين حسب الأقسام
const technicians = {
    cad: [
        {name:"قاسم عسيري", off:false},
        {name:"أحمد كوشان", off:false},
        {name:"عبدالله الرشيد", off:false},
        {name:"عبدالله الشهراني", off:false},
        {name:"أحمد القحطاني", off:false},
        {name:"يحيى عسيري", off:true} // إجازة
    ],
    pfm: [
        {name:"سلطان الأحمري", off:true}, // إجازة
        {name:"أيمن الشهري", off:false},
        {name:"فيصل الوادعي", off:false}
    ],
    ortho: [
        {name:"تركي الشهري", off:true}, // إجازة
        {name:"وليد الشهري", off:false},
        {name:"أسامة عسيري", off:false}
    ],
    removable: [
        {name:"رشيد الكثيري", off:false},
        {name:"أحمد الصخري", off:false},
        {name:"عبداللطيف عسيري", off:false},
        {name:"محمد الشرفان", off:false},
        {name:"الاء", off:false},
        {name:"هيام", off:false},
        {name:"محمد الغامدي", off:false},
        {name:"منصور العويرضي", off:false}
    ],
    temp: [
        {name:"أحمد الشبل", off:false},
        {name:"وليد السويري", off:false},
        {name:"فهد العتيبي", off:false},
        {name:"عبدالله العود", off:false}
    ],
    casting: [
        {name:"فهد الخميس", off:false}
    ]
};
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script>document.getElementById("caseType").addEventListener("change", function () {
    let type = this.value.trim();

    let rejectedCases = [
        "RPD 3 teeth or less",
        "TM 3 teeth or less",
        "RPD ثلاث اسنان او اقل",
        "TM ثلاث اسنان او اقل"
    ];

    document.getElementById("rejectAlert").style.display =
        document.getElementById("caseType").addEventListener("change", function () {
    let type = this.value.trim();

    let rejectedCases = [
        "RPD 3 teeth or less",
        "TM 3 teeth or less",
        "RPD ثلاث اسنان او اقل",
        "TM ثلاث اسنان او اقل"
    ];

    document.getElementById("rejectAlert").style.display =
        rejectedCases.includes(type) ? "block" : "none";
});
document.getElementById("department").addEventListener("change", function () {
    let dep = this.value;
    let techSelect = document.getElementById("technician");

    techSelect.innerHTML = "";

    if (!technicians[dep]) return;

    technicians[dep].forEach(tech => {
        let option = document.createElement("option");
        option.value = tech.name;
        option.textContent = tech.off ? tech.name + " (إجازة)" : tech.name;

        if (tech.off) option.style.color = "orange"; 
        else techSelect.appendChild(option);
    });
});    
       function saveCase() {

    // رفض الحالات المرفوضة
    let type = document.getElementById("caseType").value.trim();
    let rejectedCases = [
        "RPD 3 teeth or less",
        "TM 3 teeth or less",
        "RPD ثلاث اسنان او اقل",
        "TM ثلاث اسنان او اقل"
    ];

    if (rejectedCases.includes(type)) {
        alert("❌ لا يمكن حفظ هذه الحالة لأنها مرفوضة من قبل المعمل");
        return;
    }

    // بيانات الإدخال
    let name = document.getElementById("patientName").value;
    let file = document.getElementById("fileNumber").value;
    let doctor = document.getElementById("doctor").value;
    let assistant = document.getElementById("assistant").value;
    let clinic = document.getElementById("clinic").value;
    let tech = document.getElementById("technician").value;

    let caseNumber = Math.floor(100000 + Math.random() * 900000); // رقم توزيع 6 أرقام
    let time = new Date().toLocaleTimeString("en-US");
    let date = new Date().toLocaleDateString("en-US");

    // عرض النتيجة
    document.getElementById("resultText").innerHTML =
        `اسم المريض: ${name}<br>
         رقم الملف: ${file}<br>
         رقم التوزيع: ${caseNumber}<br>
         الفني المسؤول: ${tech}<br>
         التاريخ: ${date} / ${time}`;

    // QR CODE
    let qr = new QRious({
        element: document.getElementById("qrCode"),
        value: `${name} - ${file} - Case:${caseNumber}`,
        size: 200
    });

    document.getElementById("resultCard").style.display = "block";
}
</script>
</body>
</html> 
        rejectedCases.includes(type) ? "block" : "none";
});
