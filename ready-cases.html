<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© - LABX</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg">
<div class="layout">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img" alt="LABX Dental">
            <div class="brand-text">
                <div class="brand-title">LABX DENTAL</div>
                <div class="brand-sub">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</div>
            </div>
        </div>

        <div class="top-header-left">
            <div class="user-info">
                <span class="hello">ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ </span>
                <span id="username" class="user-name"></span>
            </div>
        </div>
    </header>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main class="main-card fade-in">

        <h2>Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…</h2>
        <p id="readyCount" class="role-badge"></p>

        <div id="readyCasesContainer" class="tiles-grid slide-up"></div>

        <hr style="margin:30px 0;opacity:0.2;">

        <h2>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h2>

        <!-- BOXES SECTION -->
        <div id="boxesSection">

            <h3>RDC1</h3>
            <div class="tiles-grid">
                <button class="tile" onclick="moveToBox('RDC1 - BOX 1')">
                    RDC1 - BOX 1 <span id="c_rdc1_1">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('RDC1 - BOX 2')">
                    RDC1 - BOX 2 <span id="c_rdc1_2">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('RDC1 - BOX 3')">
                    RDC1 - BOX 3 <span id="c_rdc1_3">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('RDC1 - BOX 4')">
                    RDC1 - BOX 4 <span id="c_rdc1_4">(0)</span>
                </button>
            </div>

            <h3 style="margin-top:20px;">RDC2</h3>
            <div class="tiles-grid">
                <button class="tile" onclick="moveToBox('RDC2 - BOX 1')">
                    RDC2 - BOX 1 <span id="c_rdc2_1">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('RDC2 - BOX 2')">
                    RDC2 - BOX 2 <span id="c_rdc2_2">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('RDC2 - BOX 3')">
                    RDC2 - BOX 3 <span id="c_rdc2_3">(0)</span>
                </button>
            </div>

            <h3 style="margin-top:20px;">Ø§Ù„ØªØ®ØµØµØ§Øª</h3>
            <div class="tiles-grid">
                <button class="tile" onclick="moveToBox('Ø§Ù„Ù…Ø¤Ù‚Øª')">
                    Ø§Ù„Ù…Ø¤Ù‚Øª <span id="c_temp">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('Ø§Ù„Ù…ØªØ­Ø±Ùƒ')">
                    Ø§Ù„Ù…ØªØ­Ø±Ùƒ <span id="c_move">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('PFM')">
                    PFM <span id="c_pfm">(0)</span>
                </button>

                <button class="tile" onclick="moveToBox('CAD/CAM')">
                    CAD/CAM <span id="c_cad">(0)</span>
                </button>
            </div>

        </div>

    </main>
</div>


<script>
document.getElementById("username").innerText =
    localStorage.getItem("labxUser") || "User";

let cases = JSON.parse(localStorage.getItem("labxNewCases")) || [];

const techColors = {
    "Ù‚Ø§Ø³Ù… Ø¹Ø³ÙŠØ±ÙŠ": "#3b82f6",
    "Ø£Ø­Ù…Ø¯ ÙƒÙˆØ´Ø§Ù†": "#3b82f6",
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø´ÙŠØ¯": "#3b82f6",
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ": "#3b82f6",
    "Ø£Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ": "#3b82f6",
    "ÙŠØ­ÙŠÙ‰ Ø¹Ø³ÙŠØ±ÙŠ": "#3b82f6",

    "Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ": "#8b5cf6",
    "Ø£ÙŠÙ…Ù† Ø§Ù„Ø´Ù‡Ø±ÙŠ": "#8b5cf6",
    "ÙÙŠØµÙ„ Ø§Ù„ÙˆØ§Ø¯Ø¹ÙŠ": "#8b5cf6",

    "ØªØ±ÙƒÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ": "#14b8a6",
    "ÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ": "#14b8a6",
    "Ø£Ø³Ø§Ù…Ø© Ø¹Ø³ÙŠØ±ÙŠ": "#14b8a6",

    "Ø±Ø´ÙŠØ¯ Ø§Ù„ÙƒØ«ÙŠØ±ÙŠ": "#22c55e",
    "Ø£Ø­Ù…Ø¯ Ø§Ù„ØµØ®Ø±ÙŠ": "#22c55e",
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ø·ÙŠÙ Ø¹Ø³ÙŠØ±ÙŠ": "#22c55e",
    "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ø±ÙØ§Ù†": "#22c55e",
    "Ø§Ù„Ø§Ø¡": "#22c55e",
    "Ù‡ÙŠØ§Ù…": "#22c55e",
    "Ù…Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ": "#22c55e",
    "Ù…Ù†ØµÙˆØ± Ø§Ù„Ø¹ÙˆÙŠØ±Ø¶ÙŠ": "#22c55e",
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ": "#22c55e",

    "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´Ø¨Ù„": "#f59e0b",
    "ÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³ÙˆÙŠØ±ÙŠ": "#f59e0b",
    "ÙÙ‡Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ": "#f59e0b",
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹ÙˆØ¯": "#f59e0b",

    "ÙÙ‡Ø¯ Ø§Ù„Ø®Ù…ÙŠØ³": "#6b7280"
};


// Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
function showReadyCases() {
    const container = document.getElementById("readyCasesContainer");
    container.innerHTML = "";

    const readyCases = cases.filter(c => c.status === "Ø¬Ø§Ù‡Ø²Ø©");

    document.getElementById("readyCount").innerText =
        `Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ø§Ù„Ø¢Ù†: ${readyCases.length}`;

    readyCases.forEach(c => {
        const div = document.createElement("div");
        div.className = "tile";
        div.style.borderRight = `8px solid ${techColors[c.technicianName] || "#0f766e"}`;

        div.innerHTML = `
            <h3>${c.patientName}</h3>
            <p>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: ${c.fileNumber}</p>
            <p>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©: ${c.caseType}</p>
            <p>Ø§Ù„ÙÙ†ÙŠ: ${c.technicianName}</p>
            <p style="font-size:12px;color:#64748b;">Ø¬Ø§Ù‡Ø²Ø© Ù…Ù†Ø°: ${c.readyTime}</p>

            <button class="btn-logout"
                style="background:#0f8f5e;margin-top:10px;width:100%;"
                onclick="selectCase('${c.fileNumber}')">Ø§Ø®ØªÙŠØ§Ø±</button>

            <button class="btn-logout"
                style="background:#163a43;margin-top:10px;width:100%;"
                onclick="viewQR('${c.fileNumber}')">Ø¹Ø±Ø¶ QR</button>
        `;

        container.appendChild(div);
    });
}

let selectedCase = null;

function selectCase(file) {
    selectedCase = file;
    alert("âœ” ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„Ø© â€” Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨ÙˆÙƒØ³ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨.");
}

function moveToBox(boxName) {
    if (!selectedCase) {
        alert("âš  ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹.");
        return;
    }

    const index = cases.findIndex(c => c.fileNumber === selectedCase);

    cases[index].assignedBox = boxName;
    cases[index].status = "ØªÙ… ØªÙˆØ²ÙŠØ¹Ù‡Ø§";
    cases[index].distributedTime = new Date().toLocaleString();

    localStorage.setItem("labxNewCases", JSON.stringify(cases));

    alert("âœ” ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: " + boxName);
    selectedCase = null;
    showReadyCases();
    countBoxes();
}

function countBoxes() {
    const dist = cases.filter(c => c.status === "ØªÙ… ØªÙˆØ²ÙŠØ¹Ù‡Ø§");

    const counters = {
        "RDC1 - BOX 1": "c_rdc1_1",
        "RDC1 - BOX 2": "c_rdc1_2",
        "RDC1 - BOX 3": "c_rdc1_3",
        "RDC1 - BOX 4": "c_rdc1_4",

        "RDC2 - BOX 1": "c_rdc2_1",
        "RDC2 - BOX 2": "c_rdc2_2",
        "RDC2 - BOX 3": "c_rdc2_3",

        "Ø§Ù„Ù…Ø¤Ù‚Øª": "c_temp",
        "Ø§Ù„Ù…ØªØ­Ø±Ùƒ": "c_move",
        "PFM": "c_pfm",
        "CAD/CAM": "c_cad"
    };

    for (const box in counters) {
        const count = dist.filter(c => c.assignedBox === box).length;
        document.getElementById(counters[box]).innerText = `(${count})`;
    }
}

function viewQR(fileNumber) {
    window.location.href = `case-details.html?file=${fileNumber}`;
}

showReadyCases();
countBoxes();
</script>

</body>
</html>
