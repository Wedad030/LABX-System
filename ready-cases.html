<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© - LABX</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg">

<script>
// Ø­Ù…Ø§ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
if (localStorage.getItem("labxLogged") !== "true") {
    window.location.href = "login.html";
}
</script>

<div class="layout">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img">
            <div class="brand-text">
                <div class="brand-title">LABX DENTAL</div>
                <div class="brand-sub">Ready Cases</div>
            </div>
        </div>

        <div class="top-header-left">
            <button onclick="window.location.href='index.html'" class="btn-logout">
                Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
        </div>
    </header>


    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main class="main-card fade-in">
        <h2 style="margin-bottom:15px;">ğŸ“¦ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…</h2>

        <div id="readyContainer" class="tiles-grid slide-up"></div>
    </main>

</div>



<!-- Firebase -->
<script type="module">
import { getReadyCases } from "./firebase.js";

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù…Ù† Firebase
async function loadReady() {
    const cases = await getReadyCases();
    renderReadyCases(cases);
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ±ÙˆØª
function renderReadyCases(cases) {
    const container = document.getElementById("readyContainer");
    container.innerHTML = "";

    cases.forEach(c => {
        const card = document.createElement("div");
        card.className = "tile";

        card.innerHTML = `
            <h3>${c.patientName}</h3>
            <p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: ${c.fileNumber}</p>
            <p>ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${c.clinicNumber}</p>
            <p>ğŸ‘¨â€ğŸ”§ Ø§Ù„ÙÙ†ÙŠ: ${c.technicianName}</p>
            <p style="font-size:11px;color:#64748b;">
                Ø¬Ø§Ù‡Ø²Ø© Ù…Ù†Ø°: ${new Date(c.readyAt).toLocaleString()}
            </p>

            <button onclick="openReceive('${c.id}')" 
                class="btn-logout" 
                style="background:#0f766e;margin-top:10px;width:100%;">
                ğŸ“² ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø© (QR)
            </button>
        `;

        container.appendChild(card);
    });
}

window.openReceive = function(id) {
    window.location.href = `clinic-receive.html?id=${id}`;
};

loadReady();
</script>

</body>
</html>
