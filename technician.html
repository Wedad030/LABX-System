<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ - LABX</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg">
<div class="layout">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img" alt="LABX Dental">
            <div class="brand-text">
                <div class="brand-title">LABX DENTAL</div>
                <div class="brand-sub">Technician Panel</div>
            </div>
        </div>

        <div class="top-header-left">
            <div class="user-info">
                <span class="hello">ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ </span>
                <span id="username" class="user-name"></span>
            </div>
        </div>
    </header>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main class="main-card fade-in">

        <p class="role-badge" id="roleLabel">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</p>

        <h2 style="margin-bottom: 10px;">Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªØ­Øª Ø§Ù„Ø¹Ù…Ù„</h2>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª -->
        <div id="casesContainer" class="tiles-grid slide-up"></div>

        <h2 style="margin-top: 22px; margin-bottom: 10px;">ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h2>

        <div id="vacationAlert"
             style="padding:12px;background:#fecaca;border-radius:12px;color:#b91c1c;display:none;">
            âš ï¸ ÙŠÙˆØ¬Ø¯ ÙÙ†ÙŠ ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© â€“ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙ„Ø§Ù… Ø­Ø§Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
        </div>

        <div style="margin-top: 20px;">
            <a href="index.html"
               class="btn-logout"
               style="background:#f7666e;text-decoration:none;">Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </div>

    </main>
</div>

<script src="app.js"></script>

<script>
/* ------------------------------------------------------
   1) Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† LocalStorage
-------------------------------------------------------*/
document.getElementById("username").innerText =
    localStorage.getItem("labxUser") || "User";


/* ------------------------------------------------------
   2) Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙÙ†ÙŠÙŠÙ† (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ + Ù„ÙˆÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)
-------------------------------------------------------*/
const techColors = {

    /* Ù‚Ø³Ù… Ø§Ù„ÙƒØ§Ø¯ ÙƒØ§Ù… */
    "Ù‚Ø§Ø³Ù… Ø¹Ø³ÙŠØ±ÙŠ": { main: "#3b82f6", edited: "#22c55e" },
    "Ø£Ø­Ù…Ø¯ ÙƒÙˆØ´Ø§Ù†": { main: "#3b82f6", edited: "#22c55e" },
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø´ÙŠØ¯": { main: "#3b82f6", edited: "#22c55e" },
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ": { main: "#3b82f6", edited: "#22c55e" },
    "Ø£Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ": { main: "#3b82f6", edited: "#22c55e" },
    "ÙŠØ­ÙŠÙ‰ Ø¹Ø³ÙŠØ±ÙŠ": { main: "#3b82f6", edited: "#22c55e" },

    /* Ù‚Ø³Ù… PFM */
    "Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ": { main: "#8b5cf6", edited: "#22c55e" },
    "Ø£ÙŠÙ…Ù† Ø§Ù„Ø´Ù‡Ø±ÙŠ": { main: "#8b5cf6", edited: "#22c55e" },
    "ÙÙŠØµÙ„ Ø§Ù„ÙˆØ§Ø¯Ø¹ÙŠ": { main: "#8b5cf6", edited: "#22c55e" },

    /* Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆØ«Ø±Ùˆ */
    "ØªØ±ÙƒÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ": { main: "#14b8a6", edited: "#22c55e" },
    "ÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ": { main: "#14b8a6", edited: "#22c55e" },
    "Ø£Ø³Ø§Ù…Ø© Ø¹Ø³ÙŠØ±ÙŠ": { main: "#14b8a6", edited: "#22c55e" },

    /* Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
    "Ø±Ø´ÙŠØ¯ Ø§Ù„ÙƒØ«ÙŠØ±ÙŠ": { main: "#22c55e", edited: "#84cc16" },
    "Ø£Ø­Ù…Ø¯ Ø§Ù„ØµØ®Ø±ÙŠ": { main: "#22c55e", edited: "#84cc16" },
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ø·ÙŠÙ Ø¹Ø³ÙŠØ±ÙŠ": { main: "#22c55e", edited: "#84cc16" },
    "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ø±ÙØ§Ù†": { main: "#22c55e", edited: "#84cc16" },
    "Ø§Ù„Ø§Ø¡": { main: "#22c55e", edited: "#84cc16" },
    "Ù‡ÙŠØ§Ù…": { main: "#22c55e", edited: "#84cc16" },
    "Ù…Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ": { main: "#22c55e", edited: "#84cc16" },
    "Ù…Ù†ØµÙˆØ± Ø§Ù„Ø¹ÙˆÙŠØ±Ø¶ÙŠ": { main: "#22c55e", edited: "#84cc16" },
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ": { main: "#22c55e", edited: "#84cc16" },

    /* Ù‚Ø³Ù… Ø§Ù„Ù…Ø¤Ù‚Øª */
    "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´Ø¨Ù„": { main: "#f59e0b", edited: "#22c55e" },
    "ÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³ÙˆÙŠØ±ÙŠ": { main: "#f59e0b", edited: "#22c55e" },
    "ÙÙ‡Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ": { main: "#f59e0b", edited: "#22c55e" },
    "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹ÙˆØ¯": { main: "#f59e0b", edited: "#22c55e" },

    /* Ø§Ù„ØµØ¨ */
    "ÙÙ‡Ø¯ Ø§Ù„Ø®Ù…ÙŠØ³": { main: "#6b7280", edited: "#22c55e" },
};


/* ------------------------------------------------------
   3) Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© (Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)
-------------------------------------------------------*/
const vacationList = [
    "ØªØ±ÙƒÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
    "Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ",
    "ÙŠØ­ÙŠÙ‰ Ø¹Ø³ÙŠØ±ÙŠ",
];


/* ------------------------------------------------------
   4) Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù…Ù† LocalStorage
-------------------------------------------------------*/
let cases = JSON.parse(localStorage.getItem("labxNewCases")) || [];


/* ------------------------------------------------------
   5) Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
-------------------------------------------------------*/
function renderCases() {
    const container = document.getElementById("casesContainer");
    container.innerHTML = "";

    cases.forEach(c => {

        const isVacation = vacationList.includes(c.technicianName);

        const card = document.createElement("div");
        card.className = "tile";

        // Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„ÙÙ†ÙŠ
        card.style.borderRight =
            "8px solid " + (techColors[c.technicianName]?.main || "#0f766e");

        // Ø¥Ø°Ø§ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹Ø¯Ù‘Ù„Ø© â†’ ÙŠØ¸Ù‡Ø± Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù
        if (c.isEdited) {
            card.style.borderRight =
                "8px solid " + (techColors[c.technicianName]?.edited || "#22c55e");
        }

        card.innerHTML = `
            <h3>${c.patientName}</h3>
            <p>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: ${c.fileNumber}</p>

            ${isVacation ? `<p style="color:#f97316;font-weight:bold;">âš  Ø§Ù„ÙÙ†ÙŠ ÙÙŠ Ø¥Ø¬Ø§Ø²Ø©</p>` : ""}

            <p>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©: ${c.caseType}</p>
            <p>Ø§Ù„ÙÙ†ÙŠ: ${c.technicianName}</p>

            <p style="font-size:11px;color:#64748b">ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„: ${new Date(c.createdAt).toLocaleString()}</p>

            <button class="btn-logout"
                style="background:#163a43;margin-top:10px;width:100%;"
                onclick="markAsEdited(${c.id})">
                ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©
            </button>

            <button class="btn-logout"
                style="background:#0f8f5e;margin-top:10px;width:100%;"
                onclick="markAsReady(${c.id})">
                Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ… âœ”
            </button>
        `;

        container.appendChild(card);
    });
}


/* ------------------------------------------------------
   6) Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© (Ù„ÙˆÙ† Ø£Ø®Ø¶Ø±)
-------------------------------------------------------*/
function markAsEdited(id) {
    const index = cases.findIndex(c => c.id === id);
    if (index > -1) {
        cases[index].isEdited = true;
        localStorage.setItem("labxNewCases", JSON.stringify(cases));
        renderCases();
        alert("âœ” ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„ÙÙ†ÙŠ.");
    }
}


/* ------------------------------------------------------
   7) Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø© ÙƒØ¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…
-------------------------------------------------------*/
function markAsReady(id) {
    const index = cases.findIndex(c => c.id === id);
    if (index > -1) {
        cases[index].status = "Ø¬Ø§Ù‡Ø²Ø©";
        cases[index].readyTime = new Date().toLocaleString();

        localStorage.setItem("labxNewCases", JSON.stringify(cases));
        renderCases();
        alert("âœ” ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¶Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…!");
    }
}


/* ------------------------------------------------------
   8) Ø¥Ø°Ø§ Ø§Ù„ÙÙ†ÙŠ ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© â†’ ØªØ¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ø°ÙŠØ±
-------------------------------------------------------*/
function checkVacation() {
    const someoneInVacation = cases.some(c => vacationList.includes(c.technicianName));
    if (someoneInVacation) {
        document.getElementById("vacationAlert").style.display = "block";
    }
}


/* Ø¹Ø±Ø¶ ÙƒÙ„ Ø´ÙŠØ¡ */
renderCases();
checkVacation();

</script>

</body>
</html>
