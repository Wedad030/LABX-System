<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ - LABX</title>
    <link rel="stylesheet" href="style.css">

    <style>
        .tech-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--green-main);
        }

        .tech-sub {
            color: var(--text-muted);
            margin-bottom: 22px;
        }

        .case-card {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-main);
            margin-bottom: 18px;
            animation: cardMedium 0.55s ease-out forwards;
            opacity: 0;
            border-right: 6px solid var(--green-main);
        }

        .case-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .case-info {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .case-time {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }

        .btn-ready {
            margin-top: 12px;
            width: 100%;
            background: #0f766e;
            border-radius: var(--radius-lg);
        }
    </style>
</head>

<body class="page-enter">

<script>
// Ø­Ù…Ø§ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
if (localStorage.getItem("labxLogged") !== "true") {
    window.location.href = "login.html";
}
</script>


<div class="layout">

    <!-- ğŸ”° Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img">
            <div>
                <div class="brand-title">LABX Dental</div>
                <div class="brand-sub">Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</div>
            </div>
        </div>

        <div class="top-header-left">
            <button onclick="logout()" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>


    <!-- ğŸ¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙ†ÙŠ -->
    <div class="tech-header fade-item">Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</div>
    <div class="tech-sub fade-item">Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ù„Ùƒ Ø§Ù„Ø¢Ù†</div>

    <div id="techCases"></div>

</div>



<!-- ğŸ”¥ Firebase -->
<script type="module">
import { getAllCases, updateCaseStatus } from "./firebase.js";

async function loadTechnicianCases() {
    const allCases = await getAllCases();
    
    // Ø¹Ø±Ø¶ ÙÙ‚Ø· Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
    const underProcess = allCases.filter(c => c.status === "ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡");

    renderCases(underProcess);
}

function renderCases(cases) {
    const box = document.getElementById("techCases");
    box.innerHTML = "";

    cases.forEach(c => {
        const div = document.createElement("div");
        div.className = "case-card";

        div.innerHTML = `
            <div class="case-title">ğŸ‘¤ ${c.patientName}</div>

            <div class="case-info">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: ${c.fileNumber}</div>
            <div class="case-info">ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${c.clinicNumber}</div>
            <div class="case-info">ğŸ¦· Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©: ${c.caseType}</div>
            <div class="case-info">ğŸ‘¨â€ğŸ”§ Ø§Ù„ÙÙ†ÙŠ: ${c.technicianName}</div>

            <div class="case-time">
                Ø¨Ø¯Ø£Øª: ${new Date(c.createdAt).toLocaleString()}
            </div>

            <button class="btn btn-ready" onclick="markReady('${c.id}')">
                âœ“ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…
            </button>
        `;

        box.appendChild(div);
    });
}


// ğŸ”¥ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ "Ø¬Ø§Ù‡Ø²Ø©"
window.markReady = async function(id) {
    await updateCaseStatus(id, "Ø¬Ø§Ù‡Ø²Ø©");
    alert("âœ” ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²");

    loadTechnicianCases();
};


function logout() {
    localStorage.removeItem("labxLogged");
    window.location.href = "login.html";
}

loadTechnicianCases();
</script>

</body>
</html>
