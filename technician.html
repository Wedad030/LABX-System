<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ - LABX</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg">

<script>
// Ø­Ù…Ø§ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
if (localStorage.getItem("labxLogged") !== "true") {
    window.location.href = "login.html";
}
</script>

<div class="layout">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="top-header">
        <div class="top-header-right">
            <img src="labx.jpeg" class="logo-img">
            <div class="brand-text">
                <div class="brand-title">LABX DENTAL</div>
                <div class="brand-sub">Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</div>
            </div>
        </div>

        <div class="top-header-left">
            <button onclick="logout()" class="btn-logout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main class="main-card fade-in">
        <h2 style="margin-bottom:15px;">ğŸ”§ Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h2>

        <div id="casesContainer" class="tiles-grid slide-up"></div>
    </main>

</div>

<script>
function logout() {
    localStorage.removeItem("labxLogged");
    window.location.href = "login.html";
}
</script>


<!--  Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Firebase -->
<script type="module">
import { getAllCases, updateCaseStatus } from "./firebase.js";

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù…Ù† Firebase
async function loadCases() {
    const cases = await getAllCases();
    renderCases(cases);
}

// Ø±Ø³Ù… Ø§Ù„ÙƒØ±ÙˆØª
function renderCases(cases) {
    const container = document.getElementById("casesContainer");
    container.innerHTML = "";

    cases.forEach(c => {
        if (c.status !== "ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡") return;

        const card = document.createElement("div");
        card.className = "tile";

        card.innerHTML = `
            <h3>${c.patientName}</h3>
            <p>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: ${c.fileNumber}</p>
            <p>ğŸ¥ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${c.clinicNumber}</p>
            <p>ğŸ‘¨â€ğŸ”§ Ø§Ù„ÙÙ†ÙŠ: ${c.technicianName}</p>
            <p style="color:#64748b;font-size:12px;">
                Ù…Ù†Ø°: ${new Date(c.createdAt).toLocaleString()}
            </p>

            <button onclick="markAsReady('${c.id}')" 
                    class="btn-logout" 
                    style="background:#0f766e;width:100%;margin-top:10px;">
                âœ“ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…
            </button>
        `;

        container.appendChild(card);
    });
}

// Ø¬Ø¹Ù„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ØªØ§Ø­Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
window.markAsReady = async function(id) {
    await updateCaseStatus(id, "Ø¬Ø§Ù‡Ø²Ø©");
    alert("âœ“ Ø§Ù„Ø­Ø§Ù„Ø© Ø£ØµØ¨Ø­Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ…");

    loadCases();
};

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø§ ØªÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadCases();

</script>

</body>
</html>
